<!DOCTYPE html>
<html>

<head>
    <title>Custom Integration Example</title>
    <!-- <link rel="stylesheet" href="integrationExample.css" /> -->
    <script>
        geotab.addin.integrationExample = function (api, state) {
            var center = document.getElementById("center"),
                listCreator = function (entities) {
                    var listElement = document.createElement("ul");
                    listElement.appendChild(entities.reduce(function (frag, entity) {
                        var element = document.createElement("li");
                        element.textContent = entity.device.id; // Changed to display device ID
                        element.setAttribute("data-id", entity.device.id);
                        frag.appendChild(element);
                        return frag;
                    }, document.createDocumentFragment()));
                    return listElement;
                },
                refreshPage = function () {
                    api.call("GetFeed", {
                        typeName: "StatusData",
                        "resultsLimit": 10,
                        "fromVersion": "0000000000"
                    }, function (result) {
                        console.log("Done: ", result);
                        var list = listCreator(result.data);
                        center.innerHTML = "";
                        center.appendChild(list);
                    }, function (error) {
                        console.log(error.message);
                    });
                },
                clearOnLeaving = function () {
                    center.innerHTML = "";
                };
            return {
                initialize: function (api, state, callback) {
                    callback();
                },
                focus: function (api, state) {
                    refreshPage();
                },
                blur: function (api, state) {
                    clearOnLeaving();
                }
            }
        };
    </script>
</head>

<body>
    <div id="center">
    </div>
</body>

</html>